<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.57.2" />
    <meta name="description" content="">


    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>使用 SMS &amp; VM-import 导入 VM 指导 :: My New Hugo Site</title>

    
    <link href="/css/nucleus.css?1568602790" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1568602790" rel="stylesheet">
    <link href="/css/hybrid.css?1568602790" rel="stylesheet">
    <link href="/css/featherlight.min.css?1568602790" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1568602790" rel="stylesheet">
    <link href="/css/auto-complete.css?1568602790" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1568602790" rel="stylesheet">
    <link href="/css/theme.css?1568602790" rel="stylesheet">
    <link href="/css/hugo-theme.css?1568602790" rel="stylesheet">
    

    <script src="/js/jquery-3.3.1.min.js?1568602790"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/migration/sms_vm-import/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="http://d1mo3mx8wgjhk2.cloudfront.net/">
</a>
<a> quickstart</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1568602790"></script>
<script type="text/javascript" src="/js/auto-complete.js?1568602790"></script>
<script type="text/javascript">
    
        var baseurl = "http:\/\/d1mo3mx8wgjhk2.cloudfront.net\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1568602790"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/ai/" title="AI" class="dd-item 
        
        
        
        ">
      <a href="/ai/">
          <b>X. </b>AI
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/ai/tensorflow/" title="Deep Learning AMI下Tensorflow环境的安装与切换" class="dd-item ">
        <a href="/ai/tensorflow/">
        <b>X. </b>Deep Learning AMI下Tensorflow环境的安装与切换
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/ai/connect_alex/" title="利用Amazon Connect &#43; Lex 快速构建自己的呼叫中心 &amp; 智能语音机器人" class="dd-item ">
        <a href="/ai/connect_alex/">
        <b>X. </b>利用Amazon Connect &#43; Lex 快速构建自己的呼叫中心 &amp; 智能语音机器人
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/bi/" title="BI" class="dd-item 
        
        
        
        ">
      <a href="/bi/">
          <b>X. </b>BI
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/bi/aurora_redshift_quicksight/" title="从Aurora迁移到Redshift并利用Quicksight做数据可视化分析" class="dd-item ">
        <a href="/bi/aurora_redshift_quicksight/">
        <b>X. </b>从Aurora迁移到Redshift并利用Quicksight做数据可视化分析
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/mobile/" title="Mobile" class="dd-item 
        
        
        
        ">
      <a href="/mobile/">
          <b>X. </b>Mobile
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/mobile/serverless-image-handler/" title="S3图片处理" class="dd-item ">
        <a href="/mobile/serverless-image-handler/">
        <b>X. </b>S3图片处理
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/mobile/cognito_android/" title="基于Cognito的微信第三方登陸系統" class="dd-item ">
        <a href="/mobile/cognito_android/">
        <b>X. </b>基于Cognito的微信第三方登陸系統
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/alexa/" title="Alexa" class="dd-item 
        
        
        
        ">
      <a href="/alexa/">
          <b>X. </b>Alexa
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/alexa/account-linking-cognito/" title="AWS Cognito User Pool实现Alexa账户关联" class="dd-item ">
        <a href="/alexa/account-linking-cognito/">
        <b>X. </b>AWS Cognito User Pool实现Alexa账户关联
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/iot/" title="IOT" class="dd-item 
        
        
        
        ">
      <a href="/iot/">
          <b>X. </b>IOT
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/iot/docker/" title="IoT 开发环境： 可编译 C 的 Docker 镜像" class="dd-item ">
        <a href="/iot/docker/">
        <b>X. </b>IoT 开发环境： 可编译 C 的 Docker 镜像
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/migration/" title="Migration" class="dd-item 
        parent
        
        
        ">
      <a href="/migration/">
          <b>X. </b>Migration
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/migration/bjstozhy/" title="AWS服务迁移：从北京区到到宁夏" class="dd-item ">
        <a href="/migration/bjstozhy/">
        <b>X. </b>AWS服务迁移：从北京区到到宁夏
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/migration/dms-mongo-to-s3/" title="使用 AWS DMS 迁移 MongoDB 到 S3" class="dd-item ">
        <a href="/migration/dms-mongo-to-s3/">
        <b>X. </b>使用 AWS DMS 迁移 MongoDB 到 S3
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/migration/sms_vm-import/" title="使用 SMS &amp; VM-import 导入 VM 指导" class="dd-item active">
        <a href="/migration/sms_vm-import/">
        <b>X. </b>使用 SMS &amp; VM-import 导入 VM 指导
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/migration/s3_transmission/" title="基于Amazon ECS的国内外文件同步系统解决方案" class="dd-item ">
        <a href="/migration/s3_transmission/">
        <b>X. </b>基于Amazon ECS的国内外文件同步系统解决方案
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/migration/transferdomainroute53/" title="将域名从GoDaddy迁移至Route 53" class="dd-item ">
        <a href="/migration/transferdomainroute53/">
        <b>X. </b>将域名从GoDaddy迁移至Route 53
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/cicd/" title="CICD" class="dd-item 
        
        
        
        ">
      <a href="/cicd/">
          <b>X. </b>CICD
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/cicd/codepipeline_ecs/" title="基于CodePipeline ECS的CICD解决方案" class="dd-item ">
        <a href="/cicd/codepipeline_ecs/">
        <b>X. </b>基于CodePipeline ECS的CICD解决方案
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/cicd/cicd_jar_jenkins/" title="基于jenkins的java应用程序CICD解决方案" class="dd-item ">
        <a href="/cicd/cicd_jar_jenkins/">
        <b>X. </b>基于jenkins的java应用程序CICD解决方案
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/cicd/cicd_docker_blue_jenkins/" title="基于jenkins的容器蓝绿部署解决方案" class="dd-item ">
        <a href="/cicd/cicd_docker_blue_jenkins/">
        <b>X. </b>基于jenkins的容器蓝绿部署解决方案
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/cicd/automatic-apply-resource/" title="自动化脚本：监测 &amp; 自动启动可用资源" class="dd-item ">
        <a href="/cicd/automatic-apply-resource/">
        <b>X. </b>自动化脚本：监测 &amp; 自动启动可用资源
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/network/" title="Network" class="dd-item 
        
        
        
        ">
      <a href="/network/">
          <b>X. </b>Network
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/network/bypassicp/" title="# 在中国合法部署海外IP" class="dd-item ">
        <a href="/network/bypassicp/">
        <b>X. </b># 在中国合法部署海外IP
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/network/vpc_guide/" title="VPC配置指南" class="dd-item ">
        <a href="/network/vpc_guide/">
        <b>X. </b>VPC配置指南
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/database/" title="Database" class="dd-item 
        
        
        
        ">
      <a href="/database/">
          <b>X. </b>Database
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/database/redis_benchmark/" title="Amazon ElastiCache for Redis 基准测试" class="dd-item ">
        <a href="/database/redis_benchmark/">
        <b>X. </b>Amazon ElastiCache for Redis 基准测试
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/database/aurora-vs-mysql/" title="Aurora VS MySQL 压测" class="dd-item ">
        <a href="/database/aurora-vs-mysql/">
        <b>X. </b>Aurora VS MySQL 压测
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/database/redshift_mysql/" title="Redshift &amp; MySQL 性能对比实验" class="dd-item ">
        <a href="/database/redshift_mysql/">
        <b>X. </b>Redshift &amp; MySQL 性能对比实验
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/database/api-gateway-proxy-for-ddb/" title="利用API Gateway访问DynamoDB" class="dd-item ">
        <a href="/database/api-gateway-proxy-for-ddb/">
        <b>X. </b>利用API Gateway访问DynamoDB
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/database/mongodb/" title="将MongoDB部署到现有VPC" class="dd-item ">
        <a href="/database/mongodb/">
        <b>X. </b>将MongoDB部署到现有VPC
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/storage/" title="Storage" class="dd-item 
        
        
        
        ">
      <a href="/storage/">
          <b>X. </b>Storage
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/storage/s3fs/" title="Guide: S3FS快速部署" class="dd-item ">
        <a href="/storage/s3fs/">
        <b>X. </b>Guide: S3FS快速部署
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    

    
    <section id="footer">
      <p> </p>

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='Edit this page' href="https://github.com/yuan00yuan/test_hugo_git/tree/master/content/Migration/SMS_vm-import.md" target="blank">
                      <i class="fas fa-code-branch"></i>
                      <span id="top-github-link-text">Edit this page</span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'>Quick Start</a> > <a href='/migration/'>Migration</a> > 使用 SMS & VM-import 导入 VM 指导
          
         
          
         
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#part-1-使用sms导入vm">Part 1: 使用SMS导入VM</a>
<ul>
<li><a href="#步骤一-添加iam用户">步骤一  添加IAM用户</a></li>
<li><a href="#步骤二-在-vmware-上安装服务器迁移连接器">步骤二 在 VMware 上安装服务器迁移连接器</a>
<ul>
<li>
<ul>
<li><a href="#第一步-为-vmware-环境设置连接器">第一步：为 VMware 环境设置连接器</a></li>
<li><a href="#第二步-配置连接器">第二步：配置连接器</a></li>
<li><a href="#第三步-使用-aws-sms-控制台复制-vm">第三步：使用 AWS SMS 控制台复制 VM</a></li>
<li><a href="#第四步-监控和修改服务器复制作业">第四步： 监控和修改服务器复制作业</a></li>
<li><a href="#第五步-关闭复制">第五步： 关闭复制</a></li>
</ul></li>
</ul></li>
</ul></li>
<li><a href="#part-2-使用vm-import导入您的vm">Part 2: 使用vm-import导入您的VM</a>
<ul>
<li><a href="#步骤一-配置aws-cli">步骤一  配置AWS CLI</a></li>
<li><a href="#步骤二-配置并导出vm">步骤二 配置并导出VM</a></li>
<li><a href="#步骤三-将vm作为映像导入">步骤三 将VM作为映像导入</a>
<ul>
<li>
<ul>
<li><a href="#1-创建vm-import服务角色">1.    创建VM import服务角色</a>
<ul>
<li><a href="#上传-ova-镜像至s3存储桶">上传 ova 镜像至S3存储桶</a></li>
<li><a href="#创建服务角色">创建服务角色</a></li>
</ul></li>
<li><a href="#2-导入映像任务">2.    导入映像任务</a></li>
<li><a href="#3-检查您的导入映像任务的状态">3.    检查您的导入映像任务的状态</a></li>
</ul></li>
</ul></li>
</ul></li>
<li><a href="#参考资料">参考资料</a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              使用 SMS &amp; VM-import 导入 VM 指导
            </h1>
          

        





<h2 id="part-1-使用sms导入vm">Part 1: 使用SMS导入VM</h2>

<p>本指导将逐步描述如何使用 AWS Server Migration Service (SMS)服务将 VMware vSphere 的虚拟机映像自动迁移到 Amazon AWS。</p>

<h3 id="步骤一-添加iam用户">步骤一  添加IAM用户</h3>

<p>首先需要在控制台添加 IAM ，步骤如下：</p>

<ul>
<li>IAM 控制台中选择 Roles 和 Create new role。</li>
<li>在 Search role type 页面上，找到 SMS 并选择 Select。</li>
<li>在 Attach Policy 页面上，选择 ServerMigrationServiceRole，然后选择 Next Step。</li>
<li>在 Set role name and review 页面上，键入 Role name。<br /></li>
<li>选择 Create role。您现在应该能够在可用角色列表中看到该角色。</li>
</ul>

<h3 id="步骤二-在-vmware-上安装服务器迁移连接器">步骤二 在 VMware 上安装服务器迁移连接器</h3>

<p>介绍如何使用 AWS SMS 将 VM 从 VMware 迁移到 Amazon EC2。此信息仅适用于本地 VMware 环境中的 VM。</p>

<h5 id="第一步-为-vmware-环境设置连接器">第一步：为 VMware 环境设置连接器</h5>

<blockquote>
<p><strong>注意</strong></p>

<p>本步骤主要为 vCenter 的设置，该功能在<strong>通常情况</strong>下（ 只上传单个镜像）并<strong>不</strong>需要使用。</p>

<p>若您确认您没有使用该功能的必要则<strong>可跳过</strong>该步骤，直接从 <strong>第二步：配置连接器</strong> 开始。</p>
</blockquote>

<ol>
<li>设置 vCenter 服务账户。在 vSphere Client 点击 Home -&gt; Role -&gt; Add Role 创建一个 vCenter 用户。</li>

<li><p>右击创建的用户，点击 Edit Role，在 vCenter 中创建具有以下权限的角色：</p>

<ul>
<li>Datastore -&gt; Browse datastore and Low level file operations (Datastore.Browse 和 Datastore.FileManagement)</li>
<li>Host -&gt; Configuration -&gt; System Management (Host.Config.SystemManagement)</li>
<li>vApp -&gt; Export (VApp.Export)</li>
<li>Virtual Machine -&gt; Snapshot management -&gt; Create snapshot and Remove Snapshot (VirtualMachine.State.CreateSnapshot 和 VirtualMachine.State.RemoveSnapshot)
<br /></li>
</ul>

<p><img src="assets/SMS_vm-import/SMS01.png" alt="image 01" /></p></li>

<li><p>将此 vCenter 角色分配给连接器的服务账户，添加针对要迁移的 VM 的数据中心的传播权限。</p></li>
</ol>

<h5 id="第二步-配置连接器">第二步：配置连接器</h5>

<ol>
<li><p>在控制台中打开 AWS Server Migration，选择 Connectors -&gt; SMS Connector setup guide。</p>

<p><img src="assets/SMS_vm-import/SMS02.png" alt="image 02" /></p></li>

<li><p>在 AWS Server Migration Connector setup 页面上，选择 Download OVA 下载连接器。</p></li>

<li><p>在 vSphere 客户端点击 File -&gt; Deploy OVF Template，将下载的连接器 OVA 部署到 VMware 环境中。</p></li>

<li><p>打开连接器的虚拟机控制台并使用密码 ec2pass 以 ec2-user 身份进行登录。在系统提示时提供新密码。</p></li>

<li><p>获取连接器的 IP 地址，如下所示：</p>

<pre><code class="language-sh">Current network configuration: DHCP
IP: 192.0.2.100
Netmask: 255.255.254.0
Gateway: 192.0.2.1
DNS server 1: 192.0.2.200
DNS server 2: 192.0.2.201
DNS suffix search list: subdomain.example.com
Web proxy: not configured
Reconfigure your network:
  1. Renew or acquire a DHCP lease
  2. Set up a static IP
  3. Set up a web proxy for AWS communication
  4. Set up a DNS suffix search list
  5. Exit
Please enter your option [1-5]:
</code></pre></li>

<li><p>在连接器的网络配置菜单中，配置 DNS 后缀搜索列表中的域后缀值。</p></li>

<li><p>在 Web 浏览器中，通过 IP 地址 (<a href="https://ip-address-of-connector/">https://ip-address-of-connector/</a>) 访问连接器 VM，在页面选择 Get started now。</p>

<p><img src="assets/SMS_vm-import/SMS03.png" alt="image 03" /></p></li>

<li><p>阅读许可协议，选中复选框，然后选择 Next。</p></li>

<li><p>为连接器创建密码。</p>

<p><img src="assets/SMS_vm-import/SMS04.png" alt="image 04" /></p></li>

<li><p>选择 Upload logs automatically 和 服务器迁移连接器 auto-upgrade。</p>

<p><img src="assets/SMS_vm-import/SMS05.png" alt="image 05" /></p></li>

<li><p>对于 AWS Region，从列表中选择您所处区域。对于 AWS Credentials，输入您的 AWS 账户权限中创建的 IAM Credentials。选择 Next。</p></li>

<li><p>对于 vCenter Service Account，输入步骤 3 中的 vCenter 主机名、用户名和密码。选择 Next。</p></li>

<li><p>接受 vCenter 证书后，完成注册，然后查看连接器配置控制面板。</p>

<p><img src="assets/SMS_vm-import/SMS06.png" alt="image 06" /></p></li>

<li><p>验证 Connectors 页面中是否显示您已注册的连接器。</p></li>
</ol>

<h5 id="第三步-使用-aws-sms-控制台复制-vm">第三步：使用 AWS SMS 控制台复制 VM</h5>

<ol>
<li>如尚未导入目录，请选择 Servers -&gt; Import server catalog。如需添加的新服务器，请选择 Re-import server catalog。</li>

<li><p>选择要复制的服务器，然后选择 Create replication job。</p>

<p><img src="http://cdn.quickstart.org.cn/assets/sms-vmimport/SMS07.png" alt="image 07" /></p></li>

<li><p>在 Configure server -&gt; specific settings 页面上的 License type 列中，选择要从复制作业创建的 AMI 的许可类型。选择 Auto 时 AWS SMS 会自行选择适当的许可。注意，Linux 服务器只能使用自带许可 (BYOL)，Windows 服务器可以使用 AWS 提供的许可或 BYOL。 点击 Next。</p></li>

<li><p>在 Configure replication job settings 页面上，有以下设置可用：</p>

<ul>
<li>Replication job type - replicate server every interval 选项按您从菜单提供的间隔创建新的 AMI，创建一个重复的复制过程。 One-time migration 选项会触发服务器单个复制。</li>
<li>Start replication run - 可配置复制行为为立即开始或在未来 30 天内的某一日期和时间开始。日期和时间设置会参考浏览器的本地时间。</li>
<li>IAM service role - 提供您之前创建的 IAM 服务角色。</li>
<li>Description - 提供复制运行的描述。(可选)</li>
<li>Enable automatic AMI deletion - 当复制 AMI 数量超出数字时删除较早的复制 AMI。</li>
<li>启用通知 -  Amazon Simple Notification Service (Amazon SNS) 会在复制作业完成、失败或被删除时通知列表中的收件人。</li>
</ul></li>

<li><p>选择 Next。</p></li>

<li><p>在“Review”页面上，检查您的设置。如果所有设置均正确，请选择 Create。要更改设置，请选择 Previous。</p></li>
</ol>

<h5 id="第四步-监控和修改服务器复制作业">第四步： 监控和修改服务器复制作业</h5>

<ul>
<li><p>在 AWS SMS 控制台中，点击 Replication jobs 可查看所有复制作业。
选择其中一个复制作业，在下方的窗格中查看详细信息。Job details 选项卡显示当前复制运行的信息。Run history 选项卡显示有关选定复制作业的所有复制运行的详细信息。</p></li>

<li><p>如更改作业参数，请在 Replication jobs 页面上选择一个作业，点击 Actions -&gt; Edit replication job。在 Edit configuration job 表单中输入新信息后，选择 Save 以提交您的更改。</p></li>
</ul>

<h5 id="第五步-关闭复制">第五步： 关闭复制</h5>

<ul>
<li>如需在复制完服务器后删除复制作业创建的其他服务。请在 Replication jobs 中选择对应作业，点击 Actions -&gt; Delete replication jobs。在确认窗口中，选择 Delete。该操作不会删除创建的AMI。</li>
<li>如需清除服务器目录，请选择 Servers -&gt; Clear server catalog。</li>
<li>如需取消连接器关联，请点击 Connectors，选择要取消关联的连接器。在其信息部分的右上角点击 Disassociate，在确认窗口中选择 Disassociate。</li>
</ul>

<h2 id="part-2-使用vm-import导入您的vm">Part 2: 使用vm-import导入您的VM</h2>

<p>本指导将逐步描述如何从 VM 中导出虚拟系统，使用 AWS Command Line Interface(AWS CLI) 或 API 工具将其导入 Amazon EC2。在开始操作前，请确保您的电脑中已经安装有 AWS CLI （请参考<a href="https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/installing.html">AWS CML用户指南</a>）。</p>

<h3 id="步骤一-配置aws-cli">步骤一  配置AWS CLI</h3>

<p>安装客户端后，请在 AWS 控制台中选择 IAM User，创建安全证书并下载访问安全密钥，根据 AWS Access Key 和 AWS Secret Access Key 配置帐户。</p>

<p><img src="http://cdn.quickstart.org.cn/assets/sms-vmimport/VMImport01.png" alt="image 01" /></p>

<h3 id="步骤二-配置并导出vm">步骤二 配置并导出VM</h3>

<p>在导出前，需确保 VM 具有以下几种配置：</p>

<p>Windows系统：</p>

<ul>
<li>启用 Remote Desktop (RDP) 以进行远程访问。</li>
<li>请确保该主机防火墙 (Windows 防火墙或类似防火墙) 允许访问 RDP。</li>
<li>确保管理员账户和所有其他用户账户均有密码，否则导入可能失败。</li>
<li>在 VM 上安装适当的 .NET Framework 版本。请注意，如果需要，系统会自动在您的 VM 上安装 .NET Framework 4.5 或更高版本。</li>
<li>在您的 Windows VM 上禁用 Autologon。</li>
<li>设置 RealTimeIsUniversal 注册表项。有关更多信息，请参阅 Amazon EC2 用户指南（适用于 Windows 实例） 中的设置时间。</li>
</ul>

<p>Linux系统：</p>

<ul>
<li>在VM中启用SSH远程访问，并保证VM防火墙允许外部访问VM。虽然允许基于密码的SSH，但为安全起见，建议使用公共密钥登录。</li>
<li>在VM中配置一个非root用户。（可选）</li>
<li>确保 Linux VM 将 GRUB（传统 GRUB）或 GRUB 2 作为其启动加载程序。</li>
<li>确保 Linux VM 使用下列根文件系统之一：EXT2、EXT3、EXT4、Btrfs、JFS 或 XFS。</li>
<li>关闭所有反病毒软件，从 VMware 虚拟机上卸载 VMware 工具。</li>
<li>保持网络设置为 DHCP 而不是静态 IP 地址。</li>
<li>导入的 Linux VM使用 64 位映像</li>
</ul>

<p>完成导入准备工作后可以从虚拟环境中将 VM 导出。</p>

<p>AWS支持四种格式的磁盘：开放虚拟化存档 (OVA)、虚拟机磁盘 (VMDK)、虚拟硬盘 (VHD/VHDX) 和原始格式。您也可以选择将开放虚拟化格式 (OVF)作为导出格式，OVF通常包含一个或多个 VMDK、VHD 或 VHDX 文件。</p>

<p>有关更多信息，请参阅您的虚拟化环境的文档。例如：
  - VMware - VMware 网站上的<a href="http://pubs.vmware.com/vsphere-4-esx-vcenter/topic/com.vmware.vsphere.vmadmin.doc_41/vc_client_help/importing_and_exporting_virtual_appliances/t_export_a_virtual_machine.html">导出 OVF 模板</a>
  - Citrix - Citrix 网站上的<a href="http://docs.citrix.com/en-us/xencenter/6-2/xs-xc-vms-exportimport/xs-xc-vms-export-ovf.html">将 VM 导出为 OVF/OVA</a>
  - Microsoft Hyper-V - Microsoft 网站上的<a href="https://technet.microsoft.com/en-us/library/hh831535.aspx">导出和导入虚拟机概览</a></p>

<p>本示例中我们使用VirualBox，该应用软件是一款小巧精悍、功能齐全的免费应用软件，且支持导出OVF/OVA格式的VM。</p>

<p>导出VM时，在VirualBox主界面打开File-&gt;Export Appliance，选择需要导出的虚拟机，点击Next。
选择导出配置，这里可以选择OVF/OVA两种格式，并选择保存地址。</p>

<p><img src="http://cdn.quickstart.org.cn/assets/sms-vmimport/VMImport02.png" alt="image 02" /></p>

<p>接下来对导出的VM添加说明信息后，就可以导出了，这里大约需要等待3分钟。</p>

<p><img src="http://cdn.quickstart.org.cn/assets/sms-vmimport/VMImport03.png" alt="image 03" /></p>

<h3 id="步骤三-将vm作为映像导入">步骤三 将VM作为映像导入</h3>

<p>您可以使用 VM Import/Export 将虚拟机 (VM) 映像作为 Amazon 系统映像 (AMI) 从虚拟化环境导入到 Amazon EC2 中，并用于启动实例。随后也可以将 VM 映像从实例导回到虚拟化环境中。</p>

<h5 id="1-创建vm-import服务角色">1.    创建VM import服务角色</h5>

<p>VM Import 需要一个角色在您的账户中执行特定的操作，例如：从 Amazon S3 存储桶下载磁盘映像</p>

<h6 id="上传-ova-镜像至s3存储桶">上传 ova 镜像至S3存储桶</h6>

<p>请参考<a href="http://docs.amazonaws.cn/AmazonS3/latest/gsg/PuttingAnObjectInABucket.html">如何向 S3 存储桶添加对象</a></p>

<h6 id="创建服务角色">创建服务角色</h6>

<ul>
<li><p>利用以下策略创建名为 trust-policy.json 的文件。</p>

<pre><code class="language-sh">{
    &quot;Version&quot;: &quot;2012-10-17&quot;,
    &quot;Statement&quot;: [{
        &quot;Effect&quot;: &quot;Allow&quot;,
        &quot;Principal&quot;: { &quot;Service&quot;: &quot;vmie.amazonaws.com&quot; },
        &quot;Action&quot;: &quot;sts:AssumeRole&quot;,
        &quot;Condition&quot;: {
            &quot;StringEquals&quot;:{
                &quot;sts:ExternalId&quot;: &quot;vmimport&quot;
            }
        }
    }]
}
</code></pre></li>

<li><p>使用 create-role 命令创建名为 vmimport 的角色，并向 VM Import/Export 提供对该角色的访问权。请确保指定 trust-policy.json 文件的完整路径，并且为路径<strong>添加 file:// 前缀</strong>。</p>

<pre><code class="language-sh">aws iam create-role --role-name vmimport --assume-role-policy-document  file://trust-policy.json
</code></pre></li>

<li><p>创建名为 role-policy.json 的文件并添加下面的策略，其中，<strong>请将&lt;disk-image-file-bucket&gt; 替换为存储ova映像的S3存储桶</strong>，这里需注意，<strong>如果您在中国区，请将 Resource 中 arn:aws:s3 更改为 arn:aws-cn:s3</strong>。</p>

<pre><code class="language-sh">{
    &quot;Version&quot;:&quot;2012-10-17&quot;,
    &quot;Statement&quot;:[{
        &quot;Effect&quot;:&quot;Allow&quot;,
        &quot;Action&quot;:[
            &quot;s3:GetBucketLocation&quot;,
            &quot;s3:GetObject&quot;,
            &quot;s3:ListBucket&quot; 
        ],
        &quot;Resource&quot;:[
            &quot;arn:aws:s3:::&lt;disk-image-file-bucket&gt;&quot;,
            &quot;arn:aws:s3:::&lt;disk-image-file-bucket&gt;/*&quot;
        ]
    },
    {
        &quot;Effect&quot;:&quot;Allow&quot;,
        &quot;Action&quot;:[
            &quot;ec2:ModifySnapshotAttribute&quot;,
            &quot;ec2:CopySnapshot&quot;,
            &quot;ec2:RegisterImage&quot;,
            &quot;ec2:Describe*&quot;
        ],
        &quot;Resource&quot;:&quot;*&quot;
    }]
}
</code></pre></li>

<li><p>使用下面的 put-role-policy 命令将策略挂载到之前创建的角色。</p>

<pre><code class="language-sh">aws iam put-role-policy --role-name vmimport --policy-name vmimport             --policy-document file://role-policy.json
</code></pre></li>
</ul>

<h5 id="2-导入映像任务">2.    导入映像任务</h5>

<ul>
<li><p>创建名为containers.json的文件。其中，<strong>&lt;my-import-bucket&gt;</strong>为您上传 ova 镜像的 S3 桶的名称，<strong>&lt;vms/my-windows-2008-vm.ova&gt;</strong> 为您上传的 ova 镜像<strong>在 S3 桶中的地址</strong>。</p>

<pre><code class="language-sh">[{
    &quot;Description&quot;: &quot;Windows 2008 OVA&quot;,
    &quot;Format&quot;: &quot;ova&quot;,
    &quot;UserBucket&quot;: {
        &quot;S3Bucket&quot;: &quot;&lt;my-import-bucket&gt;&quot;,
        &quot;S3Key&quot;: &quot;&lt;vms/my-windows-2008-vm.ova&gt;&quot;
    }
}]
</code></pre>

<ul>
<li><p>导入OVA。</p>

<pre><code class="language-sh">aws ec2 import-image --description &quot; Centos 7.0 &quot; --disk-containers file://containers.json
</code></pre></li>
</ul></li>

<li><p>记录下输出信息中的 <strong>ImportTaskId</strong></p></li>
</ul>

<p><img src="http://cdn.quickstart.org.cn/assets/sms-vmimport/VMImport05.png" alt="image 05" /></p>

<h5 id="3-检查您的导入映像任务的状态">3.    检查您的导入映像任务的状态</h5>

<p>请根据上一步保留的 ImportTaskId 值自行替换该值，即可查询该任务的情况。</p>

<pre><code>aws ec2 describe-import-image-tasks --cli-input-json &quot;{ \&quot;ImportTaskIds\&quot;:         [\&quot;import-ami-fggrs8es\&quot;], \&quot;NextToken\&quot;: \&quot;abc\&quot;, \&quot;MaxResults\&quot;: 10 } &quot;
</code></pre>

<p>上述命令会根据 AWS 的处理进度，返回查询任务响应中的Status，依次为“Pending”、“Converting”、“Updating”、“Updated”、“Preparing AMI”等。整个的处理过程持续10+分钟，请耐心等待。</p>

<p><img src="http://cdn.quickstart.org.cn/assets/sms-vmimport/VMImport04.png" alt="image 04" /></p>

<h2 id="参考资料">参考资料</h2>

<ul>
<li><a href="https://docs.aws.amazon.com/zh_cn/vm-import/latest/userguide/vmimport-image-import.html">使用 VM Import/Export 将 VM 作为映像导入</a></li>
</ul>


<footer class=" footline" >
	
</footer>


        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/migration/dms-mongo-to-s3/" title="使用 AWS DMS 迁移 MongoDB 到 S3"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/migration/s3_transmission/" title="基于Amazon ECS的国内外文件同步系统解决方案" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1568602790"></script>
    <script src="/js/perfect-scrollbar.min.js?1568602790"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1568602790"></script>
    <script src="/js/jquery.sticky.js?1568602790"></script>
    <script src="/js/featherlight.min.js?1568602790"></script>
    <script src="/js/highlight.pack.js?1568602790"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1568602790"></script>
    <script src="/js/learn.js?1568602790"></script>
    <script src="/js/hugo-learn.js?1568602790"></script>

    <link href="/mermaid/mermaid.css?1568602790" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1568602790"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>

